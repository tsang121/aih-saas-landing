<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - AIH</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Dashboard Styles */
        .dashboard-layout { display: flex; min-height: 100vh; padding-top: 70px; }
        .dashboard-sidebar { width: 260px; background: rgba(30, 41, 59, 0.5); border-right: 1px solid rgba(148, 163, 184, 0.1); padding: 30px 20px; position: fixed; height: calc(100vh - 70px); overflow-y: auto; }
        .sidebar-logo { font-size: 1.5rem; font-weight: 700; color: #f8fafc; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .sidebar-logo span { color: #22c55e; }
        .sidebar-nav { list-style: none; }
        .sidebar-nav li { margin-bottom: 8px; }
        .sidebar-nav a { display: flex; align-items: center; gap: 12px; padding: 14px 16px; border-radius: 12px; color: #94a3b8; text-decoration: none; transition: all 0.2s; cursor: pointer; }
        .sidebar-nav a:hover, .sidebar-nav a.active { background: rgba(34, 197, 94, 0.1); color: #22c55e; }
        .sidebar-nav .icon { font-size: 1.2rem; }
        .sidebar-section { margin-top: 40px; padding-top: 20px; border-top: 1px solid rgba(148, 163, 184, 0.1); }
        .sidebar-section-title { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: #94a3b8; margin-bottom: 16px; padding-left: 16px; }
        .storage-bar { padding: 0 16px; margin-top: 20px; }
        .storage-label { display: flex; justify-content: space-between; font-size: 0.85rem; color: #94a3b8; margin-bottom: 8px; }
        .storage-track { background: rgba(255, 255, 255, 0.1); border-radius: 8px; height: 8px; overflow: hidden; }
        .storage-fill { background: #22c55e; height: 100%; border-radius: 8px; }
        .sidebar-user { position: absolute; bottom: 20px; left: 20px; right: 20px; padding-top: 20px; border-top: 1px solid rgba(148, 163, 184, 0.1); }
        .sidebar-user-info { display: flex; align-items: center; gap: 12px; }
        .sidebar-user-avatar { width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #22c55e, #16a34a); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.9rem; }
        .sidebar-user-name { font-weight: 600; font-size: 0.9rem; }
        .sidebar-user-email { font-size: 0.8rem; color: #94a3b8; }
        .dashboard-main { flex: 1; margin-left: 260px; padding: 40px; }
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .dashboard-header h1 { font-size: 2rem; font-weight: 700; }
        .btn-primary { background: #22c55e; color: white; border: none; padding: 14px 28px; border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary:hover { background: #16a34a; transform: translateY(-2px); }
        .dashboard-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 16px; padding: 24px; }
        .stat-value { font-size: 2.5rem; font-weight: 700; margin-bottom: 4px; }
        .stat-label { font-size: 0.9rem; color: #94a3b8; }
        .section-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 16px; padding: 30px; margin-bottom: 30px; }
        .section-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .backup-list { display: flex; flex-direction: column; gap: 12px; }
        .backup-item-row { display: flex; align-items: center; padding: 16px 20px; background: rgba(255, 255, 255, 0.02); border-radius: 12px; border: 1px solid rgba(148, 163, 184, 0.05); gap: 16px; }
        .backup-item-info { display: flex; align-items: center; gap: 14px; flex: 1; }
        .backup-item-icon { font-size: 1.5rem; }
        .backup-item-name { font-weight: 600; margin-bottom: 2px; }
        .backup-item-date { font-size: 0.85rem; color: #94a3b8; }
        .backup-item-size { color: #94a3b8; font-size: 0.9rem; min-width: 80px; text-align: right; }
        .backup-status { padding: 6px 14px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
        .backup-status.success { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
        .backup-actions { display: flex; gap: 8px; }
        .btn-icon { width: 36px; height: 36px; border-radius: 8px; border: 1px solid rgba(148, 163, 184, 0.2); background: transparent; color: #94a3b8; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .btn-icon:hover { border-color: #22c55e; color: #22c55e; background: rgba(34, 197, 94, 0.05); }
        .btn-icon.restore:hover { background: rgba(34, 197, 94, 0.1); color: #22c55e; border-color: #22c55e; }
        .btn-icon.delete:hover { background: rgba(239, 68, 68, 0.1); color: #ef4444; border-color: #ef4444; }
        .quick-actions { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .quick-action { background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 14px; padding: 24px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .quick-action:hover { transform: translateY(-2px); border-color: #22c55e; }
        .quick-action-icon { font-size: 2rem; margin-bottom: 12px; }
        .quick-action h4 { font-size: 1rem; margin-bottom: 4px; }
        .quick-action p { font-size: 0.85rem; color: #94a3b8; }
        .api-key-display { background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 10px; padding: 16px; font-family: monospace; font-size: 1rem; color: #22c55e; margin: 16px 0; word-break: break-all; display: flex; align-items: center; gap: 12px; }
        .api-key-display code { flex: 1; }
        .copy-btn { background: rgba(34, 197, 94, 0.2); border: none; color: #22c55e; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; transition: all 0.2s; }
        .copy-btn:hover { background: rgba(34, 197, 94, 0.3); }
        .restore-instructions { background: rgba(30, 41, 59, 0.5); border-radius: 12px; padding: 20px; margin-top: 16px; }
        .restore-instructions h4 { margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .restore-instructions code { background: rgba(0, 0, 0, 0.3); padding: 2px 6px; border-radius: 4px; font-size: 0.85rem; }
        .restore-instructions pre { background: rgba(0, 0, 0, 0.3); padding: 16px; border-radius: 8px; overflow-x: auto; margin: 12px 0; font-size: 0.85rem; }
        .restore-instructions li { margin: 8px 0; color: #cbd5e1; }
        .loading { text-align: center; padding: 40px; color: #94a3b8; }
        .loading-spinner { width: 40px; height: 40px; border: 3px solid rgba(34, 197, 94, 0.2); border-top-color: #22c55e; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .no-backups { text-align: center; padding: 60px 20px; color: #94a3b8; }
        .no-backups-icon { font-size: 4rem; margin-bottom: 16px; opacity: 0.5; }
        .no-backups h3 { margin-bottom: 8px; color: #f8fafc; }
        @media (max-width: 1200px) { .dashboard-stats { grid-template-columns: repeat(2, 1fr); } .quick-actions { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 900px) { .dashboard-sidebar { display: none; } .dashboard-main { margin-left: 0; } }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="container">
            <a href="index.html" class="logo">ü§ñ <span>AIH</span></a>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="index.html#features">Features</a>
                <a href="index.html#pricing">Pricing</a>
            </div>
            <div class="nav-auth">
                <button class="btn-auth-login" onclick="logout()">Log Out</button>
            </div>
        </div>
    </nav>
    
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="dashboard-sidebar">
            <div class="sidebar-logo">ü§ñ <span>AIH</span></div>
            
            <ul class="sidebar-nav">
                <li><a href="#" class="active" onclick="showSection('backups')"><span class="icon">üíæ</span> Backups</a></li>
                <li><a href="#" onclick="showSection('api')"><span class="icon">üîë</span> API Key</a></li>
                <li><a href="#" onclick="showSection('restore')"><span class="icon">üîÑ</span> Restore</a></li>
            </ul>
            
            <div class="sidebar-section">
                <div class="sidebar-section-title">Storage</div>
                <div class="storage-bar">
                    <div class="storage-label">
                        <span id="storageUsed">0 MB</span>
                        <span>1 GB</span>
                    </div>
                    <div class="storage-track">
                        <div class="storage-fill" id="storageBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-user">
                <div class="sidebar-user-info">
                    <div class="sidebar-user-avatar" id="userAvatar">-</div>
                    <div>
                        <div class="sidebar-user-name" id="userName">-</div>
                        <div class="sidebar-user-email" id="userEmail">-</div>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Backups Section -->
            <div id="section-backups">
                <div class="dashboard-header">
                    <h1>üíæ Your Backups</h1>
                    <button class="btn-primary" onclick="showInstallGuide()">
                        üì¶ Install CLI
                    </button>
                </div>
                
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="statBackups">0</div>
                        <div class="stat-label">Total Backups</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statStorage">0 MB</div>
                        <div class="stat-label">Storage Used</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statLastBackup">-</div>
                        <div class="stat-label">Last Backup</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="color: #22c55e;">‚úì</div>
                        <div class="stat-label">API Status</div>
                    </div>
                </div>
                
                <div class="section-card">
                    <h2 class="section-title">üìã Backup History</h2>
                    <div id="backupList">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            Loading backups...
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- API Key Section -->
            <div id="section-api" style="display: none;">
                <div class="dashboard-header">
                    <h1>üîë Your API Key</h1>
                </div>
                
                <div class="section-card">
                    <h2 class="section-title">üîê API Key</h2>
                    <p style="color: #94a3b8; margin-bottom: 16px;">Use this key to configure the CLI on your machine.</p>
                    
                    <div class="api-key-display">
                        <code id="apiKeyDisplay">Loading...</code>
                        <button class="copy-btn" onclick="copyApiKey()">üìã Copy</button>
                    </div>
                    
                    <button class="btn-icon" style="width: auto; padding: 8px 16px;" onclick="regenerateKey()">üîÑ Regenerate Key</button>
                </div>
                
                <div class="section-card">
                    <h2 class="section-title">‚öôÔ∏è CLI Setup</h2>
                    <div class="restore-instructions">
                        <h4>üì• Install & Configure</h4>
                        <pre>npm install -g aih-cli
aih config --api-key <span id="cliApiKey">YOUR_API_KEY</span> --email you@example.com</pre>
                    </div>
                </div>
            </div>
            
            <!-- Restore Section -->
            <div id="section-restore" style="display: none;">
                <div class="dashboard-header">
                    <h1>üîÑ Restore Backup</h1>
                </div>
                
                <div class="section-card">
                    <h2 class="section-title">üìñ How to Restore</h2>
                    <div class="restore-instructions">
                        <h4>üîÑ Restore Steps</h4>
                        <ol style="padding-left: 20px;">
                            <li>Install the CLI: <code>npm install -g aih-cli</code></li>
                            <li>Configure your API key: <code>aih config --api-key YOUR_KEY --email you@example.com</code></li>
                            <li>List your backups: <code>aih list</code></li>
                            <li>Restore a backup: <code>aih restore BACKUP_ID</code></li>
                        </ol>
                        <p style="margin-top: 16px; color: #fbbf24;">‚ö†Ô∏è Restoring will overwrite your current OpenClaw files. Make sure to backup first!</p>
                    </div>
                </div>
                
                <div class="section-card">
                    <h2 class="section-title">üìã Example</h2>
                    <pre style="color: #cbd5e1;">$ aih list
üíæ Your backups:
  4. CLI Backup - 2/5/2026, 7:43:58 AM (1.3MB) - 2/5/2026, 7:44:02 AM

$ aih restore 4
üîÑ Downloading backup #4...
  ‚Ä¢ Got download URL
  ‚Ä¢ Downloading backup file...
  ‚Ä¢ Extracting backup...
  ‚Ä¢ Restoring files...
‚úÖ Restore complete!
   Restored to: /Users/yourname/.openclaw/workspace
‚ö†Ô∏è  Please restart OpenClaw to apply changes.</pre>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_URL = 'https://aih-api-production.up.railway.app';
        let currentUser = null;
        let userApiKey = null;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadUserData();
        });
        
        function loadUserData() {
            // Get API key from localStorage
            const savedKey = localStorage.getItem('aih_apiKey');
            const savedEmail = localStorage.getItem('aih_userEmail');
            
            if (!savedKey || !savedEmail) {
                showNoAuth();
                return;
            }
            
            userApiKey = savedKey;
            currentUser = { email: savedEmail, name: savedEmail.split('@')[0] };
            
            // Update UI
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userAvatar').textContent = currentUser.name.substring(0, 2).toUpperCase();
            document.getElementById('apiKeyDisplay').textContent = userApiKey;
            document.getElementById('cliApiKey').textContent = userApiKey;
            
            // Fetch backups from API
            fetchBackups();
        }
        
        async function fetchBackups() {
            const container = document.getElementById('backupList');
            
            try {
                const response = await fetch(`${API_URL}/api/backups?apiKey=${userApiKey}`);
                const backups = await response.json();
                
                if (backups.length === 0) {
                    container.innerHTML = `
                        <div class="no-backups">
                            <div class="no-backups-icon">üíæ</div>
                            <h3>No Backups Yet</h3>
                            <p>Install the CLI and create your first backup!</p>
                        </div>
                    `;
                } else {
                    renderBackups(backups);
                    updateStats(backups);
                }
            } catch (error) {
                container.innerHTML = `<div class="no-backups"><h3>Error Loading Backups</h3><p>${error.message}</p></div>`;
            }
        }
        
        function renderBackups(backups) {
            const container = document.getElementById('backupList');
            
            container.innerHTML = backups.map(backup => `
                <div class="backup-item-row">
                    <div class="backup-item-info">
                        <div class="backup-item-icon">üíæ</div>
                        <div>
                            <div class="backup-item-name">${backup.name}</div>
                            <div class="backup-item-date">${new Date(backup.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' })}</div>
                        </div>
                    </div>
                    <div class="backup-item-size">${formatSize(backup.size)}</div>
                    <div class="backup-status success">‚úì Success</div>
                    <div class="backup-actions">
                        <button class="btn-icon restore" title="Restore Instructions" onclick="showRestoreForId(${backup.id})">üîÑ</button>
                    </div>
                </div>
            `).join('');
        }
        
        function updateStats(backups) {
            document.getElementById('statBackups').textContent = backups.length;
            
            const totalSize = backups.reduce((sum, b) => sum + (parseInt(b.size) || 0), 0);
            document.getElementById('statStorage').textContent = formatSize(totalSize);
            document.getElementById('storageUsed').textContent = formatSize(totalSize);
            document.getElementById('storageBar').style.width = Math.min((totalSize / (1024 * 1024 * 1024)) * 100, 100) + '%';
            
            if (backups.length > 0) {
                document.getElementById('statLastBackup').textContent = new Date(backups[0].createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            }
        }
        
        function formatSize(bytes) {
            if (!bytes) return '0 B';
            bytes = parseInt(bytes);
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        
        function showSection(section) {
            document.getElementById('section-backups').style.display = section === 'backups' ? 'block' : 'none';
            document.getElementById('section-api').style.display = section === 'api' ? 'block' : 'none';
            document.getElementById('section-restore').style.display = section === 'restore' ? 'block' : 'none';
            
            document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
            event.target.closest('a').classList.add('active');
        }
        
        function showNoAuth() {
            document.querySelector('.dashboard-main').innerHTML = `
                <div class="no-backups" style="margin-top: 100px;">
                    <div class="no-backups-icon">üîë</div>
                    <h3>No API Key Found</h3>
                    <p>Get your API key from the homepage first.</p>
                    <a href="index.html" class="btn-primary" style="margin-top: 20px;">Get API Key ‚Üí</a>
                </div>
            `;
        }
        
        function copyApiKey() {
            navigator.clipboard.writeText(userApiKey).then(() => {
                showNotification('API key copied!');
            });
        }
        
        async function regenerateKey() {
            if (!confirm('Regenerate API key? Old key will stop working.')) return;
            
            try {
                const response = await fetch(`${API_URL}/api/keys`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: currentUser.email, name: currentUser.name })
                });
                const data = await response.json();
                
                userApiKey = data.apiKey;
                localStorage.setItem('aih_apiKey', userApiKey);
                
                document.getElementById('apiKeyDisplay').textContent = userApiKey;
                document.getElementById('cliApiKey').textContent = userApiKey;
                
                showNotification('New API key generated!');
            } catch (error) {
                showNotification('Error: ' + error.message);
            }
        }
        
        function showRestoreForId(id) {
            showSection('restore');
            const instructions = document.querySelector('#section-restore .restore-instructions');
            instructions.innerHTML = `
                <h4>üîÑ Restore Backup #${id}</h4>
                <p>Run these commands in your terminal:</p>
                <pre>aih list
aih restore ${id}</pre>
                <p style="margin-top: 16px; color: #fbbf24;">‚ö†Ô∏è Restoring will overwrite your current OpenClaw files!</p>
            `;
        }
        
        function showInstallGuide() {
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:2000;';
            modal.innerHTML = `
                <div style="background:#1e293b;padding:40px;border-radius:20px;max-width:500px;margin:20px;">
                    <h2 style="margin-bottom:20px;">üì¶ Install AIH CLI</h2>
                    <pre style="background:rgba(0,0,0,0.3);padding:20px;border-radius:12px;overflow-x:auto;">npm install -g aih-cli</pre>
                    <p style="color:#94a3b8;margin:20px 0;">Then configure:</p>
                    <pre style="background:rgba(0,0,0,0.3);padding:20px;border-radius:12px;overflow-x:auto;">aih config --api-key ${userApiKey} --email ${currentUser.email}</pre>
                    <p style="color:#94a3b8;margin:20px 0;">Create a backup:</p>
                    <pre style="background:rgba(0,0,0,0.3);padding:20px;border-radius:12px;overflow-x:auto;">aih backup</pre>
                    <button onclick="this.closest('div').parentElement.remove()" style="margin-top:20px;padding:12px 24px;background:#22c55e;border:none;border-radius:8px;color:white;cursor:pointer;">Close</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function logout() {
            localStorage.removeItem('aih_apiKey');
            localStorage.removeItem('aih_userEmail');
            window.location.href = 'index.html';
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = 'position:fixed;bottom:24px;right:24px;padding:16px 24px;background:#22c55e;color:white;border-radius:12px;font-weight:600;z-index:3000;';
            document.body.appendChild(notification);
            setTimeout(() => { notification.style.opacity=0; setTimeout(()=>notification.remove(),300); }, 3000);
        }
    </script>
</body>
</html>
